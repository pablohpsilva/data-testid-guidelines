# Auto TestId Build-Time Plugins

This directory contains build-time automation tools that automatically inject `data-testid` attributes into your React components during compilation.

## üöÄ Babel Plugin

### Installation

```bash
npm install --save-dev @pablohpsilva/babel-plugin-auto-testid
```

### Configuration

#### Basic Setup (babel.config.js)

```javascript
module.exports = {
  plugins: [
    ['@pablohpsilva/babel-plugin-auto-testid']
  ]
};
```

#### Advanced Configuration

```javascript
module.exports = {
  plugins: [
    ['@pablohpsilva/babel-plugin-auto-testid', {
      // Separator for test ID parts (default: '.')
      separator: '.',
      
      // Include element type in test ID (default: true)
      includeElement: true,
      
      // Use component hierarchy (default: true)
      useHierarchy: true,
      
      // Skip these elements (default: ['br', 'hr', 'img'])
      skipElements: ['br', 'hr', 'img', 'svg'],
      
      // Only add to interactive elements (default: false)
      onlyInteractive: false,
    }]
  ]
};
```

## üìù How It Works

### Input Code
```jsx
function UserCard({ user }) {
  return (
    <div className="user-card">
      <h2>{user.name}</h2>
      <p>{user.email}</p>
      <button onClick={handleEdit}>Edit</button>
    </div>
  );
}

function App() {
  return (
    <div>
      <UserCard user={userData} />
    </div>
  );
}
```

### Output Code (after plugin transformation)
```jsx
function UserCard({ user }) {
  return (
    <div className="user-card" data-testid="UserCard.div">
      <h2 data-testid="UserCard.h2">{user.name}</h2>
      <p data-testid="UserCard.p">{user.email}</p>
      <button onClick={handleEdit} data-testid="UserCard.button">Edit</button>
    </div>
  );
}

function App() {
  return (
    <div data-testid="App.div">
      <UserCard user={userData} data-testid="App.UserCard" />
    </div>
  );
}
```

## üîß Integration Examples

### Create React App (with CRACO)

```javascript
// craco.config.js
module.exports = {
  babel: {
    plugins: [
      ['@pablohpsilva/babel-plugin-auto-testid', {
        onlyInteractive: process.env.NODE_ENV === 'test'
      }]
    ]
  }
};
```

### Next.js

```javascript
// next.config.js
module.exports = {
  experimental: {
    swcPlugins: [
      // SWC version coming soon
    ]
  },
  webpack: (config) => {
    config.module.rules.push({
      test: /\.(js|jsx|ts|tsx)$/,
      use: {
        loader: 'babel-loader',
        options: {
          plugins: [
            ['@pablohpsilva/babel-plugin-auto-testid']
          ]
        }
      }
    });
    return config;
  }
};
```

### Vite

```javascript
// vite.config.js
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [
    react({
      babel: {
        plugins: [
          ['@pablohpsilva/babel-plugin-auto-testid']
        ]
      }
    })
  ]
});
```

### Webpack

```javascript
// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.(js|jsx|ts|tsx)$/,
        exclude: /node_modules/,
        use: {
          loader: 'babel-loader',
          options: {
            plugins: [
              ['@pablohpsilva/babel-plugin-auto-testid']
            ]
          }
        }
      }
    ]
  }
};
```

## üéØ Environment-Specific Configuration

Only enable in test environment:

```javascript
// babel.config.js
module.exports = {
  plugins: [
    ...(process.env.NODE_ENV === 'test' ? [
      ['@pablohpsilva/babel-plugin-auto-testid']
    ] : [])
  ]
};
```

## üß™ Testing Integration

### Jest Configuration

```javascript
// jest.config.js
module.exports = {
  transform: {
    '^.+\\.(js|jsx|ts|tsx)$': ['babel-jest', {
      plugins: [
        ['@pablohpsilva/babel-plugin-auto-testid']
      ]
    }]
  }
};
```

### Testing Library Example

```javascript
import { render, screen } from '@testing-library/react';
import { UserCard } from './UserCard';

test('renders user information', () => {
  const user = { name: 'John Doe', email: 'john@example.com' };
  render(<UserCard user={user} />);
  
  // These test IDs are automatically generated by the plugin
  expect(screen.getByTestId('UserCard.h2')).toHaveTextContent('John Doe');
  expect(screen.getByTestId('UserCard.p')).toHaveTextContent('john@example.com');
  expect(screen.getByTestId('UserCard.button')).toBeInTheDocument();
});
```

## üîç Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `separator` | `string` | `'.'` | Character used to separate test ID parts |
| `includeElement` | `boolean` | `true` | Include HTML element type in test ID |
| `useHierarchy` | `boolean` | `true` | Build hierarchical test IDs based on component nesting |
| `skipElements` | `string[]` | `['br', 'hr', 'img']` | HTML elements to skip |
| `onlyInteractive` | `boolean` | `false` | Only add test IDs to interactive elements |

## üé™ Advanced Usage

### Custom Test ID Generation

```javascript
// babel.config.js
module.exports = {
  plugins: [
    ['@pablohpsilva/babel-plugin-auto-testid', {
      separator: '-',
      onlyInteractive: true,
      skipElements: ['br', 'hr', 'img', 'svg', 'path'],
    }]
  ]
};
```

### Conditional Compilation

```javascript
// Only in development and test environments
const isDev = process.env.NODE_ENV === 'development';
const isTest = process.env.NODE_ENV === 'test';

module.exports = {
  plugins: [
    ...(isDev || isTest ? [
      ['@pablohpsilva/babel-plugin-auto-testid', {
        onlyInteractive: isTest, // Only interactive elements in tests
        includeElement: isDev,   // Include element types in dev
      }]
    ] : [])
  ]
};
```

## üì¶ Bundle Size Impact

The plugin operates at build time and adds no runtime overhead. The `data-testid` attributes are:
- Removed by tree-shaking in production builds (when not used)
- Only included when the plugin is active
- Minimal impact on bundle size

## üöÄ Future Enhancements

- **SWC Plugin**: Rust-based version for faster compilation
- **ESLint Integration**: Rules to ensure consistent test ID patterns
- **IDE Extensions**: Auto-completion for generated test IDs
- **Visual Studio Code Plugin**: Hover to see generated test IDs
